<!DOCTYPE html>
<html lang="en">
<head>
	<base target="_top">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title> Where? </title>
	
	<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />

    <link rel="stylesheet" href="./leaflet.css"/>
    <script src="./leaflet.js"></script>

	<style>
		body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
	</style>
	
</head>
<body>
<div id="map"></div>
<script>
	const LAT_INIT = 38.0;
	const LON_INIT = -105.0;
	const default_zoom = 5;
	const host = "127.0.0.1";
	const port = 6969;
	const base_layer = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';
	const attriburtion = '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';
	
	var tiles = L.tileLayer(base_layer, { maxZoom: 19, attribution: attriburtion });
	var map = L.map('map', {
		center: [LAT_INIT, LON_INIT],
		zoom: default_zoom,
		layers: [tiles]
	});

	const baseLayers = {
		'Base Map': tiles
	};
	const layerControl = L.control.layers(baseLayers).addTo(map);

	var path = L.polyline([], {color: "red"});

	function onPressLatLon(event) {
		if(event.key == "Enter") {
			var lat = document.getElementsByName("lat")[0].value;
			var lon = document.getElementsByName("lon")[0].value;
			map.setView([lat, lon], default_zoom, true);
		}
	}

	function handleWSInput(event){
		
		tuple_str = event.data.split(",");
		tuple_doubles = [Number(tuple_str[0]),Number(tuple_str[1])];
		path.addLatLng(tuple_doubles);
	}

	function connectWS() {
		try {
			const socket = new WebSocket("ws://127.0.0.1:6969");

			socket.addEventListener("open", (event) => {
	  			console.log(event);
			});

			socket.addEventListener("close", (event) => {
	  			console.log(event);
			});

			socket.addEventListener("message", handleWSInput);
		}
		catch (error){
			console.error(error);
		}
	}

	connectWS();

	
	path.addTo(map);
</script>
</div>

</body>
</html>